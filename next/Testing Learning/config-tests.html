<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-Testing Learning/config-tests">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">Configuration Tests | Keypom</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://minqianlu.github.io/next/Testing Learning/config-tests"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Configuration Tests | Keypom"><meta data-rh="true" name="description" content="These features pretain to configuring the drops. Items such as start and end timestamps, throttle timestamps, custom drop roots etc."><meta data-rh="true" property="og:description" content="These features pretain to configuring the drops. Items such as start and end timestamps, throttle timestamps, custom drop roots etc."><link data-rh="true" rel="icon" href="/img/moon.png"><link data-rh="true" rel="canonical" href="https://minqianlu.github.io/next/Testing Learning/config-tests"><link data-rh="true" rel="alternate" href="https://minqianlu.github.io/next/Testing Learning/config-tests" hreflang="en"><link data-rh="true" rel="alternate" href="https://minqianlu.github.io/next/Testing Learning/config-tests" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.6ae9d3fa.css">
<link rel="preload" href="/assets/js/runtime~main.cb84ecc2.js" as="script">
<link rel="preload" href="/assets/js/main.330f5ad9.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/moon.png" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/moon.png" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Keypom</b></a><div class="navbar__item dropdown dropdown--hoverable"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/next">Next</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/next/Testing Learning/config-tests">Next</a></li><li><a class="dropdown__link" href="/">1.1</a></li><li><a class="dropdown__link" href="/1.0">1.0</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/next">Github ReadMe</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/next/Testing Learning/intro-to-testing">Testing Learning and Notes</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/next/Testing Learning/intro-to-testing">Intro to Testing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/next/Testing Learning/internals">Internals</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/next/Testing Learning/config-tests">Configs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/next/Testing Learning/FT-tests">FT tests</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/next/Testing Learning/NFT-tests">NFT tests</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/next/Testing Learning/pw-drops-test">Password Protected Drops</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/next/live-test">live-test</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/next/lunch-learn-one">Lunch and Learn 1</a></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for <!-- -->Keypom<!-- --> <b>Next</b> version.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/">latest version</a></b> (<!-- -->1.1<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Testing Learning and Notes</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Configs</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: Next</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Configuration Tests</h1><p>These features pretain to configuring the drops. Items such as start and end timestamps, throttle timestamps, custom drop roots etc.  </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="tests-contained-in-config-tests">Tests contained in Config-Tests<a class="hash-link" href="#tests-contained-in-config-tests" title="Direct link to heading">​</a></h2><p>1) Testing Delete on Empty Config<br>
<!-- -->2) Testing Start Timestamp<br>
<!-- -->3) Testing Throttle Timestamp<br>
<!-- -->4) Testing On Claim Refund Deposit<br>
<!-- -->5) Testing Custom Drop Root<br>
<!-- -->6) Testing Auto Withdraw<br>
<!-- -->7) Testing Custom Drop ID<br>
<!-- -->8) Testing Valid Config<br>
<!-- -->9) Testing End Timestamp<br>
<!-- -->10) Testing End Timestamp Key Drainage<br>
<!-- -->11) Testing Claim Interval<br>
<!-- -->12) Testing All Time Based Configs   </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="notes-from-config-tests">Notes from Config Tests<a class="hash-link" href="#notes-from-config-tests" title="Direct link to heading">​</a></h2><ul><li>Configs can be specified explicitely or not at all. By default, delete_on_empty is false and the drop will not be deleted if all the keys are used.</li><li>Claim does not receive an explicit access key. Rather, it claims <strong>using the PK that signed the <em>claim</em> transaction</strong>.<ul><li>This means that the key associated with the drop needs to be added to the ?owner or Keypom? account before you can call claim.</li><li>A target account for claim must be specified.</li></ul></li><li>In the Sandbox, you set the access key to be used to sign a transaction using the setKey function. You can update the key&#x27;s perms using updateAccessKey (ONLY AVAILABLE IN SANDBOX, THIS IS A MASSIVE SECURITY BREACH OTHERWISE LOL)</li><li>Full access keys do not have any allowance requirements to cover gas etc.</li><li>If the start timestamp is violated, claim will not work and the access key will not be deleted.</li><li><em>CAAC</em> failure still claims the key</li><li><em>CAAC</em> and <em>claim</em> will <strong>ALWAYS DELETE THE KEY BEFORE MAKING THE CROSS CONTRACT CALL</strong> to the linkdrop contract<ul><li>this is to prevent someone from calling claim or CAAC numerous times while the XCC is being made but not finalized and the Keypom contract thinks the access key is still valid</li></ul></li><li><em>CAAC</em> and <em>Claim</em> will <strong>NEVER</strong> panic. This panic can cause a discrepency between the keypom balance of each key (that is book-kept and not updated live) and the actual balance on chain. This is because a panic will roll-back a txn, meaning keypom will think the gas was not spent.</li><li>Custom DropId&#x27;s must have a value of above a billion, this is to prevent custom IDs from interfering with the automatically increasing nonce drop IDs</li><li>Start timestamps need to be defined using date.now as it uses an &quot;absolute&quot; time reference frame (since Jan 1 1970)</li><li>all timestamps are expressed in nano seconds</li><li>When keys fail due to internal reasons, such as timestamp violations, the key supply for that drop is not decremented<ul><li>internal tests are validated first before making those XCC. If they fail, it can rollback</li></ul></li><li>Once all key uses are used/claimed, the key is deleted</li><li>when creating a drop, the owner must front all the costs necessary. This means <em>generally for simple drops</em> <strong>number_of_keys X uses_per_key X deposit_per_use</strong></li><li>On Claim Refund Deposit config option is used to avoid people from rugging an onboarding drop. For example, if a drop owner wants onboard people using CAAC, the owner&#x27;s deposit will only be transfered to those that use CAAC. If the user simply calls claim, the key is used but they are not transfered any of the NEAR as they are not using it for its intended purpose. Instead, the deposit gets refunded back to the owner.</li><li>All accounts created from X drop must use predefined Y drop root. This applies to both default and custom drop roots.</li><li>delete-on-empty deletes a drop once keys are all used</li><li>start and end timestamps must be greater than the current block </li><li>claim interval allows a controlled flow of key uses. For example, if i want the user to only be able to use the key every 10mins after the drop (NOT THROTTLE BUT JUST 10MINS AFTER START TIME) I can define it that way. From there, they can choose to use right away or wait for X amount to &quot;pile up&quot; before using them. </li><li>Drop deposit arithemtic something to keep in mind, users calling claim do not sip from owner&#x27;s debit account. The owner FRONTS the cost first and then the user claims from keypom&#x27;s NEAR wallet balance.<ul><li>For example, if owner has 10NEAR keypom wallet balance and creates a drop with 1 key, 1NEAR per key use and 1use per key, the owner fronts that cost and now has 9NEAR in their keypom wallet.</li></ul></li><li>Auto-withdraw allows owners to withdraw their Keypom balance to their NEAR wallets once all their drops have been deleted. This can be used in conjunction with delete-on-empty to clear up the funders&#x27; &quot;trail&quot; on keypom.</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/main/website/docs/Testing Learning/config-tests.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/next/Testing Learning/internals"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Internals</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/next/Testing Learning/FT-tests"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">FT tests</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#tests-contained-in-config-tests" class="table-of-contents__link toc-highlight">Tests contained in Config-Tests</a></li><li><a href="#notes-from-config-tests" class="table-of-contents__link toc-highlight">Notes from Config Tests</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.cb84ecc2.js"></script>
<script src="/assets/js/main.330f5ad9.js"></script>
</body>
</html>